<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"just4coding.com","root":"/","scheme":"Gemini","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Celery是一个基于消息传递的分布式任务队列。与单纯的消息队列相比较，队列中传递的消息为任务(Task&#x2F;Job)信息，而不是数据类信息，Celery基于这些消息完成了任务信息的管理。实现这种任务管理的相似项目还有Gearman，只不过这个项目已经很久未更新了，更推荐使用Celery。 Celery支持同步和异步执行两种模式。同步模式为任务调用方等待任务执行完成，这种方式等同于RPC(Remote">
<meta property="og:type" content="article">
<meta property="og:title" content="Celery实例介绍">
<meta property="og:url" content="http://just4coding.com/2018/08/14/celery/index.html">
<meta property="og:site_name" content="Just For Coding">
<meta property="og:description" content="Celery是一个基于消息传递的分布式任务队列。与单纯的消息队列相比较，队列中传递的消息为任务(Task&#x2F;Job)信息，而不是数据类信息，Celery基于这些消息完成了任务信息的管理。实现这种任务管理的相似项目还有Gearman，只不过这个项目已经很久未更新了，更推荐使用Celery。 Celery支持同步和异步执行两种模式。同步模式为任务调用方等待任务执行完成，这种方式等同于RPC(Remote">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://just4coding.com/images/2018-08-14/1.png">
<meta property="og:image" content="http://just4coding.com/images/2018-08-14/2.png">
<meta property="article:published_time" content="2018-08-14T08:16:24.000Z">
<meta property="article:modified_time" content="2021-07-21T10:57:41.378Z">
<meta property="article:author" content="flygoast">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://just4coding.com/images/2018-08-14/1.png">

<link rel="canonical" href="http://just4coding.com/2018/08/14/celery/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Celery实例介绍 | Just For Coding</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1b2d0e9aa90f26734ba45aad8357b186";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Just For Coding</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Keep learning, keep living...</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://just4coding.com/2018/08/14/celery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="flygoast">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Just For Coding">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Celery实例介绍
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-14 16:16:24" itemprop="dateCreated datePublished" datetime="2018-08-14T16:16:24+08:00">2018-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-21 18:57:41" itemprop="dateModified" datetime="2021-07-21T18:57:41+08:00">2021-07-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index">
                    <span itemprop="name">Network</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a href="http://www.celeryproject.org/" target="_blank" rel="noopener">Celery</a>是一个基于消息传递的分布式任务队列。与单纯的消息队列相比较，队列中传递的消息为任务(Task/Job)信息，而不是数据类信息，Celery基于这些消息完成了任务信息的管理。实现这种任务管理的相似项目还有<a href="http://gearman.org/" target="_blank" rel="noopener">Gearman</a>，只不过这个项目已经很久未更新了，更推荐使用Celery。</p>
<p>Celery支持同步和异步执行两种模式。同步模式为任务调用方等待任务执行完成，这种方式等同于RPC(Remote Procedure Call)， 异步方式为任务在后台执行，调用方调用后就去做其他工作，之后再根据需要来查看任务结果。Celery自己没有实现消息队列，而是直接已存在的消息队列作为Broker角色。官方推荐的Broker为<a href="http://www.rabbitmq.com/" target="_blank" rel="noopener">RabbitMQ</a>，除此之外，Redis、Beanstalkd、MongoDB等也都支持，具体可参考<a href="http://docs.celeryproject.org/en/latest/getting-started/brokers/index.html" target="_blank" rel="noopener">官方文档</a>。</p>
<p>Celery整体架构可以理解为下图:</p>
<img src="/images/2018-08-14/1.png" class="">

<a id="more"></a>

<p>整体上包括三个角色:</p>
<ul>
<li>Celery client: 这是任务生产者，它负责将任务发送到Broker中。</li>
<li>Broker: Broker负责将任务分发给相应的celery worker。</li>
<li>Celery worker: 这是任务的执行者，完成相应的业务逻辑，在具体实现上体现为Python函数。</li>
</ul>
<p>下面我们通过实例来说明Celery用法。</p>
<p>首先，准备好Broker环境, 这里使用RabbitMQ。RabbitMQ安装及启动完成后, 首先创建必要的vhost, user并设置相应权限:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_vhost demo1</span><br><span class="line">rabbitmqctl add_user demo demo</span><br><span class="line">rabbitmqctl set_user_tags demo demotag</span><br><span class="line">rabbitmqctl rabbitmqctl set_permissions -p demo1 demo <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></span><br></pre></td></tr></table></figure>

<p>创建celery worker部分代码文件:<code>demo1.py</code>，内容如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">app = Celery(<span class="string">'demo1'</span>,</span><br><span class="line">             broker=<span class="string">'amqp://demo:demo@localhost:5672/demo1'</span>,</span><br><span class="line">             backend=<span class="string">'rpc://'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> x - y</span><br></pre></td></tr></table></figure>

<p><code>demo1</code>中实现了两个task，<code>add</code>和<code>sub</code>两个函数。<code>@app.task</code>修饰符告诉Celery这个函数并不在celery client端执行，当它们被调用时只是将调用信息通过Brocker发送给celery workers执行。<code>backend</code>参数表示celery workers执行完的结果需要保存，<code>rpc</code>表示结果将通过<code>RPC(Remote Procedure Call)</code>模式被送到RabbitMQ。如果不指定<code>backend</code>参数，任务结果将被丢弃。</p>
<p>接着，准备celery client端代码。创建<code>client.py</code>文件，内容如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"><span class="keyword">import</span> demo1</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">app1 = Celery(<span class="string">'demo1'</span>,</span><br><span class="line">              broker=<span class="string">'amqp://demo:demo@localhost:5672/demo1'</span>,</span><br><span class="line">              backend=<span class="string">'rpc://'</span>)</span><br><span class="line"></span><br><span class="line">x = demo1.add.delay(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Ready? "</span>, x.ready()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Result: "</span>, x.result</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"Ready? "</span>, x.ready()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Result: "</span>, x.result</span><br></pre></td></tr></table></figure>

<p>接下来，启动celery worker:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# celery  -A demo1 worker --loglevel&#x3D;info</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;python2.7&#x2F;site-packages&#x2F;celery&#x2F;platforms.py:796: RuntimeWarning: You&#39;re running the worker with superuser privileges: this is</span><br><span class="line">absolutely not recommended!</span><br><span class="line"></span><br><span class="line">Please specify a different user using the --uid option.</span><br><span class="line"></span><br><span class="line">User information: uid&#x3D;0 euid&#x3D;0 gid&#x3D;0 egid&#x3D;0</span><br><span class="line"></span><br><span class="line">  uid&#x3D;uid, euid&#x3D;euid, gid&#x3D;gid, egid&#x3D;egid,</span><br><span class="line"></span><br><span class="line"> -------------- celery@centos1 v4.2.0 (windowlicker)</span><br><span class="line">---- **** -----</span><br><span class="line">--- * ***  * -- Linux-3.10.0-229.14.1.el7.x86_64-x86_64-with-centos-7.1.1503-Core 2018-08-14 06:54:40</span><br><span class="line">-- * - **** ---</span><br><span class="line">- ** ---------- [config]</span><br><span class="line">- ** ---------- .&gt; app:         demo1:0x2af55d0</span><br><span class="line">- ** ---------- .&gt; transport:   amqp:&#x2F;&#x2F;demo:**@localhost:5672&#x2F;demo1</span><br><span class="line">- ** ---------- .&gt; results:     rpc:&#x2F;&#x2F;</span><br><span class="line">- *** --- * --- .&gt; concurrency: 2 (prefork)</span><br><span class="line">-- ******* ---- .&gt; task events: OFF (enable -E to monitor tasks in this worker)</span><br><span class="line">--- ***** -----</span><br><span class="line"> -------------- [queues]</span><br><span class="line">                .&gt; celery           exchange&#x3D;celery(direct) key&#x3D;celery</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[tasks]</span><br><span class="line">  . demo1.add</span><br><span class="line">  . demo1.sub</span><br><span class="line"></span><br><span class="line">[2018-08-14 06:54:40,230: INFO&#x2F;MainProcess] Connected to amqp:&#x2F;&#x2F;demo:**@127.0.0.1:5672&#x2F;demo1</span><br><span class="line">[2018-08-14 06:54:40,249: INFO&#x2F;MainProcess] mingle: searching for neighbors</span><br><span class="line">[2018-08-14 06:54:41,282: INFO&#x2F;MainProcess] mingle: all alone</span><br><span class="line">[2018-08-14 06:54:41,298: INFO&#x2F;MainProcess] celery@centos1 ready.</span><br></pre></td></tr></table></figure>

<p>执行celery client:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# python client.py</span><br><span class="line">Ready?  False</span><br><span class="line">Result:  None</span><br><span class="line">Ready?  True</span><br><span class="line">Result:  3</span><br></pre></td></tr></table></figure>

<p>从结果可以看到，第一次调用<code>x.ready()</code>查看任务是否完成时返回值为<code>False</code>, 任务结果<code>x.result</code>还没有生成。延迟3秒之后，再次调用，此时任务已经执行完成，通过<code>x.result</code>获取到了任务结果。</p>
<p>观察worker的日志输出，可以看到任务执行成功:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[2018-08-14 06:56:06,695: INFO&#x2F;MainProcess] Received task: demo1.add[ceef3d4f-c546-4853-bbf6-3e4c050a9957]</span><br><span class="line">[2018-08-14 06:56:08,734: INFO&#x2F;ForkPoolWorker-2] Task demo1.add[ceef3d4f-c546-4853-bbf6-3e4c050a9957] succeeded in 2.036982472s: 3</span><br></pre></td></tr></table></figure>

<p>在上述例子中，尽管celery client并不需要执行任务本身实现的相关代码，但还是需要<code>import</code>任务实现模块。这在一些场景下并不合适。Celery还提供了直接通过<code>AMQP</code>协议的方式来进行任务相关操作，比如，可以使用<code>app.send_task</code>函数来触发任务执行, 具体参考<a href="http://docs.celeryproject.org/en/latest/reference/celery.html#celery.Celery.send_task" target="_blank" rel="noopener">文档</a></p>
<p>我们将<code>client.py</code>修改为如下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">app1 = Celery(<span class="string">'demo1'</span>,</span><br><span class="line">              broker=<span class="string">'amqp://demo:demo@localhost:5672/demo1'</span>,</span><br><span class="line">              backend=<span class="string">'rpc://'</span>)</span><br><span class="line"></span><br><span class="line">x = app1.send_task(<span class="string">'demo1.add'</span>, args=[<span class="number">1</span>, <span class="number">2</span>], kwargs=&#123;&#125;)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Ready? "</span>, x.ready()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Result: "</span>, x.result</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"Ready? "</span>, x.ready()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Result: "</span>, x.result</span><br></pre></td></tr></table></figure>

<p>再次执行client, 结果与之前一致:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# python client.py</span><br><span class="line">Ready?  False</span><br><span class="line">Result:  None</span><br><span class="line">Ready?  True</span><br><span class="line">Result:  3</span><br></pre></td></tr></table></figure>

<p>除了上述的异步任务，Celery还支持周期性任务(Periodic Tasks)。这种任务依赖另一个<code>celery beat</code>进程根据配置周期性地将任务发往broker。</p>
<p>我们设置每10秒钟执行一次<code>demo1.add</code>任务, 这需要在<code>demo1.py</code>中添加如下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.conf.beat_schedule = &#123;</span><br><span class="line">    ‘add_every_10_seconds<span class="string">': &#123;</span></span><br><span class="line"><span class="string">        '</span>task<span class="string">': '</span>demo1.add<span class="string">',</span></span><br><span class="line"><span class="string">        '</span>schedule<span class="string">': 10.0,</span></span><br><span class="line"><span class="string">        '</span>args<span class="string">': (1, 2),</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>重新启动celery worker， 并启动celery beat:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# celery -A demo1 beat</span><br><span class="line">celery beat v4.2.0 (windowlicker) is starting.</span><br><span class="line">__    -    ... __   -        _</span><br><span class="line">LocalTime -&gt; 2018-08-14 08:02:05</span><br><span class="line">Configuration -&gt;</span><br><span class="line">    . broker -&gt; amqp:&#x2F;&#x2F;demo:**@localhost:5672&#x2F;demo1</span><br><span class="line">    . loader -&gt; celery.loaders.app.AppLoader</span><br><span class="line">    . scheduler -&gt; celery.beat.PersistentScheduler</span><br><span class="line">    . db -&gt; celerybeat-schedule</span><br><span class="line">    . logfile -&gt; [stderr]@%WARNING</span><br><span class="line">    . maxinterval -&gt; 5.00 minutes (300s)</span><br></pre></td></tr></table></figure>

<p>我们可以从worker日志中看到周期性的任务执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[2018-08-14 08:12:05,666: INFO&#x2F;MainProcess] Received task: demo1.add[4d08d394-2d19-48ce-bb4b-d39c58f42f47]</span><br><span class="line">[2018-08-14 08:12:07,669: INFO&#x2F;ForkPoolWorker-2] Task demo1.add[4d08d394-2d19-48ce-bb4b-d39c58f42f47] succeeded in 2.002474438s: 3</span><br><span class="line">[2018-08-14 08:12:35,686: INFO&#x2F;MainProcess] Received task: demo1.add[55837f1d-b7dc-4c08-965b-215d92132394]</span><br><span class="line">[2018-08-14 08:12:37,692: INFO&#x2F;ForkPoolWorker-2] Task demo1.add[55837f1d-b7dc-4c08-965b-215d92132394] succeeded in 2.003697262s: 3</span><br><span class="line">[2018-08-14 08:13:05,704: INFO&#x2F;MainProcess] Received task: demo1.add[8d8591de-52cd-4271-b079-5f94b7f41af1]</span><br><span class="line">[2018-08-14 08:13:07,709: INFO&#x2F;ForkPoolWorker-2] Task demo1.add[8d8591de-52cd-4271-b079-5f94b7f41af1] succeeded in 2.003211596s: 3</span><br><span class="line">[2018-08-14 08:13:35,725: INFO&#x2F;MainProcess] Received task: demo1.add[1f546d46-fd5d-4572-9712-5848459a4cea]</span><br><span class="line">[2018-08-14 08:13:37,730: INFO&#x2F;ForkPoolWorker-2] Task demo1.add[1f546d46-fd5d-4572-9712-5848459a4cea] succeeded in 2.003228644s: 3</span><br></pre></td></tr></table></figure>

<p>除了上边这种简单的执行频率设置，Celery还支持以<code>crontab</code>的形式来设定执行时间，这种方式需要注意时区的设置, 具体的参数参考<a href="http://docs.celeryproject.org/en/latest/reference/celery.schedules.html#celery.schedules.crontab" target="_blank" rel="noopener">文档</a></p>
<p>下面我们以crontab有形式设置每分钟执行一次<code>demo1.add</code>, 将<code>demo1.py</code>修改为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">app = Celery(<span class="string">'demo1'</span>,</span><br><span class="line">             broker=<span class="string">'amqp://demo:demo@localhost:5672/demo1'</span>,</span><br><span class="line">             backend=<span class="string">'rpc://'</span>)</span><br><span class="line"></span><br><span class="line">app.conf.beat_schedule = &#123;</span><br><span class="line">    <span class="string">'every_minute'</span>: &#123;</span><br><span class="line">        <span class="string">'task'</span>: <span class="string">'demo1.add'</span>,</span><br><span class="line">        <span class="string">'schedule'</span>: crontab(minute=<span class="string">'*/1'</span>),</span><br><span class="line">        <span class="string">'args'</span>: (<span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> x - y</span><br></pre></td></tr></table></figure>

<p>重启worker和beat, 观察worker的执行日志, 可以看到约每分钟执行了一次任务:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[2018-08-14 08:42:18,011: INFO&#x2F;MainProcess] Received task: demo1.add[b532debb-49b4-4b9a-ac83-a3dad6ebe68c]</span><br><span class="line">[2018-08-14 08:42:20,032: INFO&#x2F;ForkPoolWorker-2] Task demo1.add[b532debb-49b4-4b9a-ac83-a3dad6ebe68c] succeeded in 2.019885588s: 3</span><br><span class="line">[2018-08-14 08:43:00,039: INFO&#x2F;MainProcess] Received task: demo1.add[9fa61f49-5bcb-47dc-9d18-7c921fd5ed18]</span><br><span class="line">[2018-08-14 08:43:02,044: INFO&#x2F;ForkPoolWorker-2] Task demo1.add[9fa61f49-5bcb-47dc-9d18-7c921fd5ed18] succeeded in 2.003939354s: 3</span><br><span class="line">[2018-08-14 08:44:00,056: INFO&#x2F;MainProcess] Received task: demo1.add[cd1f0f5b-9bea-4764-ad42-9a62102d419f]</span><br><span class="line">[2018-08-14 08:44:02,062: INFO&#x2F;ForkPoolWorker-2] Task demo1.add[cd1f0f5b-9bea-4764-ad42-9a62102d419f] succeeded in 2.00425067799s: 3</span><br></pre></td></tr></table></figure>

<p>从beat的debug级别的日志中也可以看调度信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# celery -A demo1 beat --loglevel&#x3D;debug</span><br><span class="line">celery beat v4.2.0 (windowlicker) is starting.</span><br><span class="line">__    -    ... __   -        _</span><br><span class="line">LocalTime -&gt; 2018-08-14 08:42:46</span><br><span class="line">Configuration -&gt;</span><br><span class="line">    . broker -&gt; amqp:&#x2F;&#x2F;demo:**@localhost:5672&#x2F;demo1</span><br><span class="line">    . loader -&gt; celery.loaders.app.AppLoader</span><br><span class="line">    . scheduler -&gt; celery.beat.PersistentScheduler</span><br><span class="line">    . db -&gt; celerybeat-schedule</span><br><span class="line">    . logfile -&gt; [stderr]@%DEBUG</span><br><span class="line">    . maxinterval -&gt; 5.00 minutes (300s)</span><br><span class="line">[2018-08-14 08:42:46,250: DEBUG&#x2F;MainProcess] Setting default socket timeout to 30</span><br><span class="line">[2018-08-14 08:42:46,251: INFO&#x2F;MainProcess] beat: Starting...</span><br><span class="line">[2018-08-14 08:42:46,259: DEBUG&#x2F;MainProcess] Current schedule:</span><br><span class="line">&lt;ScheduleEntry: every_minute demo1.add(1, 2) &lt;crontab: *&#x2F;1 * * * * (m&#x2F;h&#x2F;d&#x2F;dM&#x2F;MY)&gt;</span><br><span class="line">[2018-08-14 08:42:46,259: DEBUG&#x2F;MainProcess] beat: Ticking with max interval-&gt;5.00 minutes</span><br><span class="line">[2018-08-14 08:42:46,259: DEBUG&#x2F;MainProcess] beat: Waking up in 13.73 seconds.</span><br><span class="line">[2018-08-14 08:43:00,003: DEBUG&#x2F;MainProcess] beat: Synchronizing schedule...</span><br><span class="line">[2018-08-14 08:43:00,024: DEBUG&#x2F;MainProcess] Start from server, version: 0.9, properties: &#123;&#39;information&#39;: &#39;Licensed under the MPL.  See http:&#x2F;&#x2F;www.rabbitmq.com&#x2F;&#39;, &#39;product&#39;: &#39;RabbitMQ&#39;, &#39;copyright&#39;: &#39;Copyright (C) 2007-2018 Pivotal Software, Inc.&#39;, &#39;capabilities&#39;: &#123;&#39;exchange_exchange_bindings&#39;: True, &#39;connection.blocked&#39;: True, &#39;authentication_failure_close&#39;: True, &#39;direct_reply_to&#39;: True, &#39;basic.nack&#39;: True, &#39;per_consumer_qos&#39;: True, &#39;consumer_priorities&#39;: True, &#39;consumer_cancel_notify&#39;: True, &#39;publisher_confirms&#39;: True&#125;, &#39;cluster_name&#39;: &#39;rabbit@centos1&#39;, &#39;platform&#39;: &#39;Erlang&#x2F;OTP 21.0.3&#39;, &#39;version&#39;: &#39;3.7.7&#39;&#125;, mechanisms: [&#39;PLAIN&#39;, &#39;AMQPLAIN&#39;], locales: [u&#39;en_US&#39;]</span><br><span class="line">[2018-08-14 08:43:00,027: INFO&#x2F;MainProcess] Scheduler: Sending due task every_minute (demo1.add)</span><br><span class="line">[2018-08-14 08:43:00,030: DEBUG&#x2F;MainProcess] using channel_id: 1</span><br><span class="line">[2018-08-14 08:43:00,031: DEBUG&#x2F;MainProcess] Channel open</span><br><span class="line">[2018-08-14 08:43:00,037: DEBUG&#x2F;MainProcess] demo1.add sent. id-&gt;9fa61f49-5bcb-47dc-9d18-7c921fd5ed18</span><br><span class="line">[2018-08-14 08:43:00,037: DEBUG&#x2F;MainProcess] beat: Waking up in 59.95 seconds.</span><br><span class="line">[2018-08-14 08:44:00,051: INFO&#x2F;MainProcess] Scheduler: Sending due task every_minute (demo1.add)</span><br><span class="line">[2018-08-14 08:44:00,054: DEBUG&#x2F;MainProcess] demo1.add sent. id-&gt;cd1f0f5b-9bea-4764-ad42-9a62102d419f</span><br><span class="line">[2018-08-14 08:44:00,054: DEBUG&#x2F;MainProcess] beat: Waking up in 59.94 seconds.</span><br></pre></td></tr></table></figure>
<p>在实际应用场景中，我们往往需要关注任务的执行状态及信息统计。Celery提供了一些命令可以来监控worker和tasks的状态。</p>
<p><code>status</code>命令可以查看worker列表:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# celery -A demo1 status</span><br><span class="line">celery@centos1: OK</span><br><span class="line"></span><br><span class="line">1 node online.</span><br></pre></td></tr></table></figure>

<p><code>inspect active</code>命令可以查看worker正在执行的任务，没有任务时显示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# celery -A demo1 inspect active</span><br><span class="line">-&gt; celery@centos1: OK</span><br><span class="line">    - empty -</span><br></pre></td></tr></table></figure>

<p>当worker执行任务时，显示出了正在执行的任务信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# celery -A demo1 inspect active</span><br><span class="line">-&gt; celery@centos1: OK</span><br><span class="line">    * &#123;u&#39;args&#39;: u&#39;[1, 2]&#39;, u&#39;time_start&#39;: 1534227677.0447896, u&#39;name&#39;: u&#39;demo1.add&#39;, u&#39;delivery_info&#39;: &#123;u&#39;priority&#39;: 0, u&#39;redelivered&#39;: False, u&#39;routing_key&#39;: u&#39;celery&#39;, u&#39;exchange&#39;: u&#39;&#39;&#125;, u&#39;hostname&#39;: u&#39;celery@centos1&#39;, u&#39;acknowledged&#39;: True, u&#39;kwargs&#39;: u&#39;&#123;&#125;&#39;, u&#39;type&#39;: u&#39;demo1.add&#39;, u&#39;id&#39;: u&#39;92fd8829-b1a8-4239-95ac-aeabca724bc5&#39;, u&#39;worker_pid&#39;: 25917&#125;</span><br></pre></td></tr></table></figure>

<p><code>inspect status</code>命令可以获取worker的统计信息，它输出的信息非常丰富，具体可以参考<a href="http://docs.celeryproject.org/en/latest/userguide/workers.html#worker-statistics" target="_blank" rel="noopener">文档</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# celery -A demo1 inspect stats</span><br><span class="line">-&gt; celery@centos1: OK</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;broker&quot;: &#123;</span><br><span class="line">            &quot;alternates&quot;: [],</span><br><span class="line">            &quot;connect_timeout&quot;: 4,</span><br><span class="line">            &quot;failover_strategy&quot;: &quot;round-robin&quot;,</span><br><span class="line">            &quot;heartbeat&quot;: 120.0,</span><br><span class="line">            &quot;hostname&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">            &quot;insist&quot;: false,</span><br><span class="line">            &quot;login_method&quot;: &quot;AMQPLAIN&quot;,</span><br><span class="line">            &quot;port&quot;: 5672,</span><br><span class="line">            &quot;ssl&quot;: false,</span><br><span class="line">            &quot;transport&quot;: &quot;amqp&quot;,</span><br><span class="line">            &quot;transport_options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;uri_prefix&quot;: null,</span><br><span class="line">            &quot;userid&quot;: &quot;demo&quot;,</span><br><span class="line">            &quot;virtual_host&quot;: &quot;demo1&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;clock&quot;: &quot;343&quot;,</span><br><span class="line">        &quot;pid&quot;: 25909,</span><br><span class="line">        &quot;pool&quot;: &#123;</span><br><span class="line">            &quot;max-concurrency&quot;: 2,</span><br><span class="line">            &quot;max-tasks-per-child&quot;: &quot;N&#x2F;A&quot;,</span><br><span class="line">            &quot;processes&quot;: [</span><br><span class="line">                25916,</span><br><span class="line">                25917</span><br><span class="line">            ],</span><br><span class="line">            &quot;put-guarded-by-semaphore&quot;: false,</span><br><span class="line">            &quot;timeouts&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;writes&quot;: &#123;</span><br><span class="line">                &quot;all&quot;: &quot;100.00%&quot;,</span><br><span class="line">                &quot;avg&quot;: &quot;100.00%&quot;,</span><br><span class="line">                &quot;inqueues&quot;: &#123;</span><br><span class="line">                    &quot;active&quot;: 0,</span><br><span class="line">                    &quot;total&quot;: 2</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;raw&quot;: &quot;1&quot;,</span><br><span class="line">                &quot;strategy&quot;: &quot;fair&quot;,</span><br><span class="line">                &quot;total&quot;: 1</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;prefetch_count&quot;: 8,</span><br><span class="line">        &quot;rusage&quot;: &#123;</span><br><span class="line">            &quot;idrss&quot;: 0,</span><br><span class="line">            &quot;inblock&quot;: 88,</span><br><span class="line">            &quot;isrss&quot;: 0,</span><br><span class="line">            &quot;ixrss&quot;: 0,</span><br><span class="line">            &quot;majflt&quot;: 1,</span><br><span class="line">            &quot;maxrss&quot;: 31160,</span><br><span class="line">            &quot;minflt&quot;: 15953,</span><br><span class="line">            &quot;msgrcv&quot;: 0,</span><br><span class="line">            &quot;msgsnd&quot;: 0,</span><br><span class="line">            &quot;nivcsw&quot;: 20,</span><br><span class="line">            &quot;nsignals&quot;: 0,</span><br><span class="line">            &quot;nswap&quot;: 0,</span><br><span class="line">            &quot;nvcsw&quot;: 502,</span><br><span class="line">            &quot;oublock&quot;: 8,</span><br><span class="line">            &quot;stime&quot;: 0.509435,</span><br><span class="line">            &quot;utime&quot;: 0.327057</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;total&quot;: &#123;</span><br><span class="line">            &quot;demo1.add&quot;: 1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>除此之外，Celery的一个关联项目<a href="https://flower.readthedocs.io/en/latest/" target="_blank" rel="noopener">flower</a>提供了基于WEB的实时监控。</p>
<p>可以直接使用pip安装flower:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flower</span><br></pre></td></tr></table></figure>

<p>启动flower, 默认情况下，flower监听<code>127.0.0.1:5555</code>, 我们可以通过<code>address</code>参数来设定监听地址:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">celery -A demo1 flower --address=0.0.0.0 --port=5555</span><br></pre></td></tr></table></figure>

<p>使用浏览器访问flower的地址, 可以看到flower的Dashboard页面:</p>
<img src="/images/2018-08-14/2.png" class="">

<p><code>flower</code>不只提供了监控能力，还提供了执行任务的<code>REST API</code>。我们可以直接通过HTTP请求来提交任务, 比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 celery]# curl -X POST -d &#39;&#123;&quot;args&quot;:[1,2]&#125;&#39; &#39;http:&#x2F;&#x2F;127.0.0.1:5555&#x2F;api&#x2F;task&#x2F;async-apply&#x2F;demo1.add?refresh&#x3D;True&#39;</span><br><span class="line">&#123;&quot;task-id&quot;: &quot;fde316ea-7aed-4a85-8255-06935c5b015a&quot;, &quot;state&quot;: &quot;PENDING”&#125;</span><br></pre></td></tr></table></figure>

<p>但这些API的稳定性还有些问题，不建议生产环境使用。具体API细节请参考<a href="http://flower.readthedocs.io/en/latest/api.html" target="_blank" rel="noopener">文档</a>。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/08/08/openstack-l2-vfw/" rel="prev" title="OpenStack私有网络二层接入虚拟防火墙">
      <i class="fa fa-chevron-left"></i> OpenStack私有网络二层接入虚拟防火墙
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/09/07/newt/" rel="next" title="TUI库newt和snack简要介绍">
      TUI库newt和snack简要介绍 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">flygoast</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">112</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">flygoast</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.1
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
